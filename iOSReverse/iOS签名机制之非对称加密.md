
# iOS签名机制之非对称加密

<br>

本文只是为了理解iOS签名机制，而对**对称加密**和**非对称加密**的简单介绍，不涉及原理。

<br>

## 一、对称加密

信息的加密、解密使用同一个密钥的加密方式称为对称加密。常用的对称加密有`DES`、`3DES`、`AES`。

![输入图片说明](https://images.gitee.com/uploads/images/2019/0107/153343_b89337b0_1355277.png "Snip20190107_1.png")


### 0x01 DES

- `DES(Data Encryption Standard)`是一种将64bit明文加密成64bit密文的对称加密算法，密钥长度56bit。

- 规格上来说，密钥长度是64bit，但每隔7bit会设置一个用于错误检查的bit，因此密钥长度实质上是56bit。

- 每次只能加密64bit的数据，遇到比较大的数据，需要对DES加密进行迭代（反复）。

- `DES`加密强度不够，能够被暴力破解，现在已很少使用。

![输入图片说明](https://images.gitee.com/uploads/images/2019/0107/154034_40d7e9f3_1355277.png "Snip20190107_2.png")


### 0x02 3DES

- `3DES`和`DES`几乎一样，不同的是`3DES`使用了三个密钥，对数据进行三次`DES`加密。

![输入图片说明](https://images.gitee.com/uploads/images/2019/0107/154611_7373fb06_1355277.png "Snip20190107_4.png")


- **注意** 若三个密钥是同一个，则`3DES`就变成了普通的`DES`。

- `3DES`的加密强度相比较`DES`虽已增加，但也能暴力破解且管理三个密钥太过繁琐，现在基本已被弃用。


### 0x03 AES

- `AES(Advanced Encryption Standard)`高级加密标准，是现在公认的最安全的加密方式，是对称密钥加密中最流行的算法。

- AES的密钥长度有128、192、256bit三种。


### 0x04 优缺点

- 优: 算法公开，计算量小，加密速度快，加密效率高

- 缺: 存在密钥配送问题，万一密钥丢失，会造成数据泄露。

那下面引入一种能解决密钥配送问题的算法 -- 非对称加密

<br>

## 二、非对称加密


非对称加密(Asymmetric Cryptography): 信息的加密、解密使用不同密钥的加密方式, 也称为公钥加密(Public-key Cryptography)。

![输入图片说明](https://images.gitee.com/uploads/images/2019/0107/162737_e40d0d1c_1355277.png "Snip20190107_5.png")

- 非对称加密的公钥和私钥一一对应，成对生成。

- 若用公钥对数据进行加密，只有用对应的私钥才能解密。
 
- 若用私钥对数据进行加密，只有用对应的公钥才能解密。

- 非对称加密使用最广泛的非对称加密是`RSA`


### 0x01 解决对称加密中密钥配送问题

![输入图片说明](https://images.gitee.com/uploads/images/2019/0107/211302_15381faa_1355277.png "Snip20190107_6.png")


1. 消息接受者生成公钥、私钥，并把公钥发送给消息发送者；

2. 消息发送者发送消息时，先用公钥加密，再把加密后的密文发送给接收者；

3. 消息接收者拿到密文后，用私钥解密，得到明文消息。


**问题:** 这样虽然能解决密钥配型问题，但非对称加密加密解密的速度比较慢，而消息发送又很频繁，这该咋办呢？ 往下看。。


### 0x02 混合密钥系统


所谓混合密钥系统是指对称加密和非对称加密混合使用，已达到即能解决对称加密的密钥配问题，又能解决非对称加密速度慢的问题。网络上的密码通信所用的SSL/TLS都运用了混合密码系统

- 混合密钥系统加密流程

    ![输入图片说明](https://images.gitee.com/uploads/images/2019/0107/214547_003c5afc_1355277.png "Snip20190107111.png")


1. 消息发送者要拥有消息接收者的公钥；

2. 消息发送者会为本次通信会生成一个临时的会话密钥，作为对称密钥；

3. 用会话密钥对发送的明文信息加密，得到密文(对称加密速度较快)；

4. 用消息接收者的公钥加密会话密钥(解决密钥配送问题)；

5. 将用对称加密后的密文和用非对称加密的会话密钥，一起发送给接收者。

<br>

- 混合密钥系统解密流程

    ![输入图片说明](https://images.gitee.com/uploads/images/2019/0107/214654_fc0da9ae_1355277.png "Snip20190107_8.png")


1. 消息接收者先将加密后的会话密钥和加密后的消息分离；

2. 用自己的私钥对加密后的会话密钥解密

3. 用解密后的会话密钥解密消息，得到明文信息。


<br>
**写于2019-01-07**
<br>